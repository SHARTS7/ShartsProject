<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sharts</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link rel="shortcut icon" href="icons/logoresponsivaA.svg">
    <link rel="stylesheet" href="css/style-padm_mb.css">
    <link rel="stylesheet" href="css/style-padm_pc.css">
    <link rel="stylesheet" href="css/style_pc.css">
    <link rel="stylesheet" href="css/style_mb.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@600&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@600;800&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="js/notify.js"></script>

</head>
<body>
    <header>

        <a href="/" id="LogoSharts"><img src="icons/Logotipo-sharts.svg" alt="Logotipo Sharts"></a>

        <nav class="menu">
            <input type="checkbox">
            <div class="menu-hamb">
                <span></span>
                <span></span>
                <span></span>
            </div>

            <ul>
                <li><a href="/radio">Radio</a></li>
                <li><a href="#contato-ancora">Contato</a></li>
            </ul>

        </nav>

        <div class="perfil-login">

            <a href="#" id="entrar-btn"><span><%= autenticado.autenticado %></span></a>
            <!-- <a href="#" id="IconePerfil"><img src="icons/profile.svg" alt="Ícone de Perfil do usuário"></a> -->
            <% if(autenticado){
                %>
               
            <% 
        
               let arquivo = {"imagem":"imagens/img-perfil.png"};
        
               if(img_perfil_pasta != null){ 
                    arquivo.imagem = img_perfil_pasta;
               }
            %>
        

           <div class="perfil-radius">
            <div></div>
            <a href="#" id="IconePerfil"><img class="icone-perfil" src="<%= arquivo.imagem %>"></a>
        </div>
        
            <% }else{ %>
                <a href="#" id="IconePerfil"><img src="icons/profile.svg" id="nologin-img" alt="Ícone de Perfil do usuário"></a>
            <% } %>
        </div>

        <nav id="u-sessao">
            <ul>
                <li id="login-btn"><a href="/login"><span class="material-icons">login</span>Login</a></li>
                <li id="cadastro-btn"><a href="/cadastro-page"><span class="material-icons">add_circle_outline</span>Cadastrar-se</a></li>
                <% if(autenticado){ %>

               <script>
                var btn_login = document.getElementById("login-btn");
                btn_login.style.display = "none";

                var btn_cadastro = document.getElementById("cadastro-btn");
                btn_cadastro.style.display = "none";
               </script>
               <li><a href="/perfil"><span class="material-icons">person_outline</span>Meu perfil</a></li>
                <li><a href="/sair" method="POST" id="sair-btn"><span class="material-icons">logout</span>Sair</a></li>
            
                <% }else{ %>

                <% } %>

                <!-- <li><a href="/sair" method="POST" id="sair-btn">Sair</a></li> -->
            </ul>
        </nav>

    </header>

    <main>

        <% 

        let arquivo = {"imagem":"imagens/img-perfil.png"}
     
        if(valores.img_perfil_pasta != null){
            arquivo.imagem = valores.img_perfil_pasta
        }

    let msgErro = {"nome":"", "email":"" }
    let avisoErro = {"nome":"", "email":""}
    if(listaErros){
        listaErros.errors.forEach(function(itemErro){
            if(itemErro.path == "nome"){
                avisoErro.nome = "erro";
                msgErro.nome += " "+itemErro.msg
            %>
            <script>
                notify("Erro no preenchimento","Verifique o campo nome<br><%= itemErro.msg%>", "error", "center")                        
            </script>
            <%
        }
        if(itemErro.path == "email"){
            avisoErro.email = "erro";
            msgErro.email = itemErro.msg
            %>
            <script>
                notify("Erro no preenchimento","Verifique o campo e-mail", "error", "center")                        
            </script>
            <%
        }
        })
    }
    
    if (dadosNotificacao) { 

        %>
        <script>
                notify("<%= dadosNotificacao.titulo%>","<%= dadosNotificacao.mensagem%>", "<%= dadosNotificacao.tipo%>", "center")
                
                if("<%= dadosNotificacao.tipo %>" == "success"){
                    setTimeout(function(){
                        window.location="/"
                    }, 3000)
                }                        
        </script>
    <% } %>

    <h1>Painel Administrativo</h1> 
    <label for="editSlides" id="label-edSl">Editar Slides</label>

    <section class="slider-edit" name="editSlides">

        <div class="img-s-edicao">
            <img src="imagens/Slide_3.png" alt="Imagem de edição slides">
            <img src="imagens/Slide_2.png" alt="Imagem de edição slides">
            <img src="imagens/Slide_2.png" alt="Imagem de edição slides">
        </div>

        <br>

        <div class="slider-options">
            <div class="btns-n-p">
                <button id="regredir_slide" id="scroll-up"><span class="material-symbols-outlined"> chevron_left </span></button>
                <button id="avançar_slide"><span class="material-symbols-outlined"> chevron_right </span></button>
            </div>

            <div class="load-slide-img">
                <input type="file">
            </div>

            <div class="s-and-c">
                <button id="save">Salvar</button>
                <button id="cancel">Cancelar</button>
            </div>
        </div>
    </section>

    <section class="membros_posts">
        <label for="members_posts" id="label-mb">Membros</label>
        <div class="members_posts-div" name="members_posts">
                <span><span class="material-symbols-outlined">group</span><%= totalUsuarios %> Usuários</span>
                <div class="linha-vertical"></div>
                <span><span class="material-symbols-outlined">perm_media</span>67 Posts</span>
        </div>

    </section>

    <div class="search">
        <input type="text" id="pesquisa" placeholder="Pesquisar">
        <span class="material-symbols-outlined" onclick="abrirPopUp_a()">filter_alt </span>
    </div>

    <div class="pop-up-a">
        <div class="modal-a">
            <hr />
                <h2>Selecione os filtros que deseja utilizar:</h2>
                <span>Por categoria:</span>
                <select name="fitler-cat" id="fitler-cat">
                    <option value="artesvisuais">Artes Visuais</option>
                    <option value="cinema">Cinema</option>
                    <option value="danca">Dança</option>
                    <option value="musica">Música</option>
                    <option value="teatro">Teatro</option>
                    <option value="fotografia">Fotografia</option>
                </select>

                <br>

                <div class="filter-option">
                    <span>Por tipo:</span>
                    <input type="checkbox" name="" id="p-tipo">
                </div>

                <div class="filter-option">
                    <span>Por status:</span>
                    <input type="checkbox" name="" id="p-status">
                </div>

                <script>
                    let p_tipo = document.querySelector("#p-tipo");
                    let p_status = document.querySelector("#p-status");

                    p_tipo.addEventListener("click", function() {
                        if (p_tipo.checked) {
                            p_status.checked = false; // Desmarca a outra opção
                        }
                    });

                    p_status.addEventListener("click", function() {
                        if (p_status.checked) {
                            p_tipo.checked = false; // Desmarca a outra opção
                        }
                    });
                </script>

                <div class="filter-option">
                    <span>Ordem Alfabética:</span>
                    <input type="checkbox" name="" id="">
                </div>

                <div class="filter-option">
                    <span>Ativos Primeiro:</span>
                    <input type="checkbox" name="" id="">
                </div>
                
            <hr/>
            <div class="btns">
                <button class="btn-sim-a" >Pesquisar</button>
                <button class="btn-nao-a" onclick="closePopUp_a()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
            function abrirPopUp_a(){
                const modal = document.querySelector(".pop-up-a");
                modal.classList.add('active-a');
            }

            function closePopUp_a() {
                document.querySelector(".pop-up-a").classList.remove("active-a");
            }
    </script>

    <section class="usuarios">
        <table>
            <thead>
                <tr>
                    <th><span class="material-symbols-outlined">badge</span>Nome</th>
                    <th><span class="material-symbols-outlined">supervised_user_circle</span>Tipo</th>
                    <th><span class="material-symbols-outlined">progress_activity</span>Status usuário</th>
                </tr>
            </thead>
            <tbody>
                <% usuarios.forEach(function(usuario, index) { %>
                    <tr>
                        <td>
                            <span class="material-symbols-outlined" title="Reativar Usuário" onclick="abrirPopUpR(<%= usuario.id_usuario %>)" id="reatv-user">check_circle</span>
                            <img src="<%= usuario.img_perfil_pasta ? usuario.img_perfil_pasta : 'imagens/img-perfil.png' %>" alt="Imagem <%= index + 1 %>"><%= usuario.nome %>
                            <span class="material-symbols-outlined" onclick="abrirPopUp(<%= usuario.id_usuario %>)" title="Desativar Usuário">delete</span>
                            <span class="material-symbols-outlined" title="Editar Usuário">edit</span>
                            
                        </td>
                        <td>
                            <% if (usuario.tipo_usuario === 1) { %>
                                Comum
                            <% } else if (usuario.tipo_usuario === 2) { %>
                                Administrador
                            <% } else if (usuario.tipo_usuario === 3) { %>
                                Administrador Tipo 2
                            <% } %>
                        </td>
                        <td><%= usuario.status_usuario %></td>
                    </tr>
                <% }); %>
            </tbody>
        </table>
    </section>

    <br>

<div class="pop-up">
    <div class="modal">
        <hr />
            <h2>Você tem certeza que deseja continuar?</h2>
            <span>Ao continuar o usuario selecionado será desativado!</span>
        <hr />
        <div class="btns">
            <button class="btn-sim" onclick="desativarUsuario()">Sim</button>
            <button class="btn-nao" onclick="closePopUp()">Não</button>
        </div>
    </div>
</div>

<div class="pop-up" id="reactivate-popup">
    <div class="modal">
        <hr />
            <h2>Você tem certeza que deseja continuar?</h2>
            <span>Ao continuar o usuario selecionado será reativado!</span>
        <hr />
        <div class="btns">
            <button class="btn-sim" onclick="reativarUsuario()">Sim</button>
            <button class="btn-nao" onclick="closePopUpR()">Não</button>
        </div>
    </div>
</div>

<script>
  function abrirPopUp(id) {
  const modal = document.querySelector(".pop-up");

  modal.setAttribute('data-usuario-id', id);
  modal.classList.add('active');
}

function abrirPopUpR(id) {
  const modal = document.querySelector("#reactivate-popup");

  modal.setAttribute('data-usuario-id', id);
  modal.classList.add('active');
}

function closePopUpR() {
      document.querySelector("#reactivate-popup").removeAttribute("data-usuario-id");
      document.querySelector("#reactivate-popup").classList.remove("active");
    }
  
    // Função para fechar o pop-up de confirmação
    function closePopUp() {
      document.querySelector(".pop-up").removeAttribute("data-usuario-id");
      document.querySelector(".pop-up").classList.remove("active");
    }
  
    // Função para desativar o usuário
    async function desativarUsuario() {
      const modal = document.querySelector(".pop-up");
      const userIdToDelete = modal.getAttribute("data-usuario-id");
  
      if (userIdToDelete) {
        try {
          const response = await fetch(`/desativar-usuario/${userIdToDelete}`, {
            method: "POST",
          });
  
          if (response.ok) {
            // O usuário foi desativado com sucesso, você pode atualizar a tabela ou fazer ações apropriadas
          } else {
            console.error("Erro ao desativar o usuário:", response.statusText);
            console.log("Erro ao desativar o usuário:", error);
          }
        } catch (error) {
          console.error("Erro ao desativar o usuário:", error);
          console.log("Erro ao desativar o usuário:", error);
        }
  
        closePopUp();
        location.reload();
      }
    }

    // Reativar Usuário

    async function reativarUsuario() {
      const modal = document.querySelector("#reactivate-popup");
      const userIdToReactivate = modal.getAttribute("data-usuario-id");
  
      if (userIdToReactivate) {
        try {
          const response = await fetch(`/reativar-usuario/${userIdToReactivate}`, {
            method: "POST",
          });
  
          if (response.ok) {
            // O usuário foi desativado com sucesso, você pode atualizar a tabela ou fazer ações apropriadas
          } else {
            console.error("Erro ao reativar o usuário:", response.statusText);
            console.log("Erro ao reativar o usuário:", error);
          }
        } catch (error) {
          console.error("Erro ao reativar o usuário:", error);
          console.log("Erro ao reativar o usuário:", error);
        }
  

        closePopUpR();
        location.reload();
      }
    }
  </script>



    </main>


    <footer>

        <div class="blocofooter">

            <div class="ShartsGroup">
                <img src="icons/Logotipo-sharts.svg" id="LogoShartsFooter" alt="Logotipo Sharts">
                <h2>Group</h2>

                <div class="redes-sociais-contato">

                    <span id="contato-ancora"></span>

                    <a href="#"><img src="icons/facebook.png" alt="Logo facebook"></a>
                    <a href="#"><img src="icons/instagram.png" alt="Logo instagram"></a>
                    <a href="#"><img src="icons/reddit.png" alt="Logo reddit"></a>

                </div>
            </div>

            <ul>
                <li><a href="/sobrenos">Sobre nós</a></li>
                <li><a href="#">Sharts Music+</a></li>
                <li><a href="#">Sharts para artistas</a></li>
                <li><a href="/termosECond">Termos e condições</a></li>
                <li>2022</li>
            </ul>

        </div>

    </footer>

    <script src="js/script.js"></script>
    <script src="js/script_menu.js"></script>
</body>
</html>